version: 1
metadata:
  name: Flow - Default Recovery
context:
  name: Welcome to authentik!
  title: Welcome to authentik!
  show_matched_user: false
  email_confirmation_sender: system@authentik.local
  email_recovery_subject: authentik
  email_recovery_template: email/password_reset.html
entries:
#~~~~~~~~~~~~~~~~~~~~~~~~~~~ Dependency blueprints ~~~~~~~~~~~~~~~~~~~~~~~~~~~~#
- model: authentik_blueprints.metaapplyblueprint
  attrs:
    identifiers:
      name: Prompt Stage - Password and Password Repeat
    required: true

- model: authentik_blueprints.metaapplyblueprint
  attrs:
    identifiers:
      name: User Write Stage - Default
    required: true

- model: authentik_blueprints.metaapplyblueprint
  attrs:
    identifiers:
      name: User Login Stage - Default
    required: true
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Groups ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~#
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Policies ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~#
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Flows ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~#
- model: authentik_flows.flow
  id: flow
  identifiers:
    slug: default-recovery-flow
  attrs:
    designation: recovery
    name: !Context name
    title: !Context title
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Prompts ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~#
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Stages ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~#
- model: authentik_stages_identification.identificationstage
  id: default-recovery-identification-stage
  identifiers:
    name: default-recovery-identification-stage
  attrs:
    user_fields:
    - email
    - username
    show_matched_user: !Context show_matched_user

- model: authentik_stages_email.emailstage
  id: default-recovery-confirm-email-email-stage
  identifiers:
    name: default-recovery-confirm-email-email-stage
  attrs:
    subject: !Context email_recovery_subject
    template: !Context email_recovery_template
    use_global_settings: true
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Stage bindings ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~#
- model: authentik_flows.flowstagebinding
  identifiers:
    stage: !KeyOf default-recovery-identification-stage
    target: !KeyOf flow
  attrs:
    order: 100

- model: authentik_flows.flowstagebinding
  identifiers:
    stage: !KeyOf default-recovery-confirm-email-email-stage
    target: !KeyOf flow
  attrs:
    order: 200

- model: authentik_flows.flowstagebinding
  identifiers:
    stage: !Find [authentik_stages_prompt.promptstage, [name, password-and-password-repeat-prompt-stage]]
    target: !KeyOf flow
  attrs:
    order: 300

- model: authentik_flows.flowstagebinding
  identifiers:
    stage: !Find [authentik_stages_user_write.userwritestage, [name, default-user-write-stage]]
    target: !KeyOf flow
  attrs:
    order: 400

- model: authentik_flows.flowstagebinding
  identifiers:
    stage: !Find [authentik_stages_user_login.userloginstage, [name, default-user-login-stage]]
    target: !KeyOf flow
  attrs:
    order: 900
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Policy bindings ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~#
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Tenants ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~#